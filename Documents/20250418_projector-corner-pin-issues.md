# 블렌더 프로젝터 애드온 4코너 보정 기능 개발 문제점 분석

## 프로젝트 개요
블렌더 프로젝터 애드온에 4코너 보정(Corner Pin) 기능을 추가하여 투사된 이미지의 각 모서리를 독립적으로 조정할 수 있는 기능을 개발하고자 했습니다.

## 구현 방식
1. 독립적인 `corner_pin` 모듈 생성
2. 노드 기반 4코너 변환 로직 구현
3. UI 패널 및 컨트롤 추가
4. 기존 프로젝터 노드 트리와 통합

## 발생한 문제점

### 1. 노드 생성 및 연결 문제
- 코너 핀 노드가 성공적으로 생성되고 노드 트리에 연결되었지만, 실제로 프로젝션에는 변화가 나타나지 않음
- 노드 에디터에서는 `CornerPinCorrection` 노드가 보이고 코너 값 변경도 반영되지만 실제 텍스처 왜곡이 발생하지 않음

### 2. 블렌더 버전 호환성 문제
- **블렌더 4.3**: 
  - 코너 값 조절이 노드에 반영됨
  - 실제 프로젝션에는 변화가 없음
  - 쉐이더 API 변경으로 인한 일부 오류 발생
- **블렌더 2.93**:
  - 코너 값 조절이 노드에 반영되지 않음
  - 쉐이더 에디터에서 직접 값을 조절해도 프로젝션에 영향 없음
  - "cannot find suitable shader" 오류 발생

### 3. 노드 그룹 로직 문제
- CornerPinCorrection 노드 그룹의 내부 로직이 투영 변환을 제대로 처리하지 못함
- 노드 연결은 올바르게 되어 있으나 실제 처리 로직에 문제가 있는 것으로 추정

### 4. UV 좌표 변환 문제
- 블렌더의 쉐이더 노드를 통한 UV 좌표 변환이 예상대로 작동하지 않음
- 일부 코너 값이 0~1 범위를 벗어난 비정상적인 값으로 설정됨 (예: Top Left: [8.610, 1.000, 0.000])

## 시도된 해결 방법

1. **기본 구조 구현**:
   - corner_pin 모듈 기본 구조 생성
   - 코너 좌표 속성 및 기본 데이터 구조 정의
   - 기존 프로젝터 코드와의 통합 지점 확인

2. **노드 그룹 구현**:
   - 코너 핀 변환 로직 구현
   - 노드 그룹 생성 및 연결
   - 보간 기반 변환 로직 구현

3. **UI 및 상호작용 개선**:
   - 직관적인 코너 조정 UI 구현
   - 미세 조정 버튼 추가
   - 프리셋 시스템 구현

4. **디버깅 및 테스트**:
   - 버전별 문제점 확인
   - 노드 에디터에서 직접 확인
   - 테스트 코드 추가

## 가능한 원인

1. **블렌더 쉐이더 API 변경**:
   - 블렌더 4.3에서 쉐이더 시스템과 노드 처리 방식이 이전 버전과 크게 달라짐
   - 노드 그룹 인터페이스가 변경됨 (예: `interface.new_socket()` vs `inputs.new()`)

2. **노드 연결 및 데이터 흐름 문제**:
   - UV 좌표가 노드를 통과하지만 실제 변환이 제대로 적용되지 않음
   - 투영 변환 행렬 계산에 문제가 있을 수 있음

3. **스팟라이트 쉐이더 구현 방식의 한계**:
   - 프로젝터 애드온이 스팟라이트 노드 트리를 사용하는 방식이 변경된 쉐이더 시스템과 호환되지 않을 수 있음

## 권장 해결 방향

1. **대체 접근법 시도**:
   - 노드 기반 구현 대신 프로젝터 텍스처 자체를 변환하는 방식 고려
   - 카메라의 변환 매트릭스를 직접 조작하는 방법 고려

2. **더 단순한 구현으로 시작**:
   - 복잡한 4코너 보정 대신 기본적인 키스톤 효과(수직/수평 왜곡)만 먼저 구현
   - 성공적으로 작동하면 점진적으로 기능 확장

3. **블렌더 버전별 분기 처리**:
   - 블렌더 버전을 감지하여 버전별로 다른 구현 방식 적용
   - 각 버전에 맞는 쉐이더 API 사용

4. **문서 및 커뮤니티 참고**:
   - 블렌더 개발 문서 및 API 변경사항 참조
   - 블렌더 아티스트 커뮤니티에서 비슷한 기능 구현 사례 조사

## 결론

4코너 보정 기능 구현은 기술적으로 가능하지만, 블렌더의 버전별 차이와 쉐이더 시스템의 복잡성으로 인해 추가적인 연구와 접근법 변경이 필요합니다. 노드 기반 구현에 문제가 지속된다면 대체 접근법을 고려해야 합니다.
